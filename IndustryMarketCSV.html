<!DOCTYPE html>
<html lang="en">
<head>
<link rel="apple-touch-icon-precomposed" sizes="57x57" href="apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="favicon-128.png" sizes="128x128" />
<meta name="application-name" content="&nbsp;"/>
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="mstile-310x310.png" />

<meta charset="UTF-8">
<title>Ender Invader || Industry Market CSV</title>
<style type="text/css">
    body {
        font-family: Arial, sans-serif;
    }
	* {
  box-sizing: border-box;
}
</style>
</head>
<body>
	
<div>
<form id="ddata" action="/action_page.php">
  Save Data: <input type="text" name="fdata" value=""><br>
</form>

<script src="libraries/cryptojs-aes.min.js" type="text/javascript"></script>
<button onclick="downloadCVS()">Download CVS</button>

<p id="display"></p>
</div>	
<script>
function downloadCVS() {
  var data = document.getElementById("ddata").elements[0].value;

  var save = openSave(data);

  var prices = save['price'];


  var items = [];
  for (resourceName in prices) {
    price = prices[resourceName];

    if (resourceName != 'Cash' && resourceName != 'RP' && resourceName != 'PP' && resourceName != 'Sci' && resourceName != 'Cul' && resourceName != 'Pmpk') {
      if (dictionary[resourceName.toLowerCase()]) {
        resourceName = dictionary[resourceName.toLowerCase()][1]
      }

      items.push({ Resource: resourceName, Price: Math.round(price['price'])})
    }
  }

  const replacer = (key, value) => value === null ? '' : value; // specify how you want to handle null values here
  const header = Object.keys(items[0]);
  let csv = items.map(row => header.map(fieldName => JSON.stringify(row[fieldName], replacer)).join(','));
  csv.unshift(header.join(','));
  csv = csv.join('\r\n');

  //Download the file as CSV
  var downloadLink = document.createElement("a");
  var blob = new Blob(["\ufeff", csv]);
  var url = URL.createObjectURL(blob);
  downloadLink.href = url;
  downloadLink.download = "DataDump.csv";  //Name the file here
  document.body.appendChild(downloadLink);
  downloadLink.click();
  document.body.removeChild(downloadLink);
}


function openSave(data) {
  var AES_KEY = '4t7w!z%C*F-JaNdRgUkXp2s5v8x/A?D(';
  
  var decrypt = CryptoJS.AES.decrypt(data, AES_KEY).toString(CryptoJS.enc.Utf8);

  decrypt = JSON.parse(decrypt);
	
  return decrypt;
}



function JSON2CSV(objArray) {
    var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
    var str = '';
    var line = '';

    if ($("#labels").is(':checked')) {
        var head = array[0];
        if ($("#quote").is(':checked')) {
            for (var index in array[0]) {
                var value = index + "";
                line += '"' + value.replace(/"/g, '""') + '",';
            }
        } else {
            for (var index in array[0]) {
                line += index + ',';
            }
        }

        line = line.slice(0, -1);
        str += line + '\r\n';
    }

    for (var i = 0; i < array.length; i++) {
        var line = '';

        if ($("#quote").is(':checked')) {
            for (var index in array[i]) {
                var value = array[i][index] + "";
                line += '"' + value.replace(/"/g, '""') + '",';
            }
        } else {
            for (var index in array[i]) {
                line += array[i][index] + ',';
            }
        }

        line = line.slice(0, -1);
        str += line + '\r\n';
    }
    return str;
}

var dictionary = {
  'fe': ['Fe', 'Iron'],
  'iron': ['Fe', 'Iron'],
  'wood': ['Wood', 'Wood'],
  'coal': ['Coal', 'Coal'],
  'al': ['Al', 'Aluminum'],
  'aluminum': ['Al', 'Aluminum'],
  'si': ['Si', 'Silicon'],
  'silicon': ['Si', 'Silicon'],
  'cu': ['Cu', 'Copper'],
  'copper': ['Cu', 'Copper'],
  'oil': ['Oil', 'Oil'],
  'cr': ['Cr', 'Chromium'],
  'chromium': ['Cr', 'Chromium'],
  'ti': ['Ti', 'Titanium'],
  'titanium': ['Ti', 'Titanium'],
  'u': ['U', 'Uranium'],
  'uranium': ['U', 'Uranium'],
  'gas': ['Gas', 'Gas'],
  'li': ['Li', 'Lithium'],
  'lithium': ['Li', 'Lithium'],
  'steel': ['Steel', 'Steel'],
  'mpsy': ['MpSy', 'Maple Syrup'],
  'maplesyrup': ['MpSy', 'Maple Syrup'],
  'petrol': ['Petrol', 'Petrol'],
  'pla': ['Pla', 'Plastic'],
  'plastic': ['Pla', 'Plastic'],
  'paper': ['Paper', 'Paper'],
  'clo': ['Clo', 'Clothes'],
  'clothes': ['Clo', 'Clothes'],
  'lumb': ['Lumb', 'Lumber'],
  'lumber': ['Lumb', 'Lumber'],
  'sho': ['Sho', 'Shoes'],
  'shoes': ['Sho', 'Shoes'],
  'gui': ['Gui', 'Guitar'],
  'guitar': ['Gui', 'Guitar'],
  'dynm': ['Dynm', 'Dynamite'],
  'dynamite': ['Dynm', 'Dynamite'],
  'eru': ['ErU', 'Enriched Uranium'],
  'enricheduranium': ['ErU', 'Enriched Uranium'],
  'bat': ['Bat', 'Battery'],
  'battery': ['Bat', 'Battery'],
  'dru': ['Dru', 'Drum'],
  'drum': ['Dru', 'Drum'],
  'glass': ['Glass', 'Glass'],
  'gun': ['Gun', 'Gun'],
  'sem': ['Sem', 'Semiconductor'],
  'semiconductor': ['Sem', 'Semiconductor'],
  'cam': ['Cam', 'Camera'],
  'camera': ['Cam', 'Camera'],
  'fas': ['Fas', 'Fashion'],
  'fashion': ['Fas', 'Fashion'],
  'video': ['Video', 'Video'],
  'toy': ['Toy', 'Toy'],
  'scr': ['Scr', 'Screen'],
  'screen': ['Scr', 'Screen'],
  'eng': ['Eng', 'Engine'],
  'engine': ['Eng', 'Engine'],
  'mus': ['Mus', 'Music'],
  'music': ['Mus', 'Music'],
  'book': ['Book', 'Book'],
  'pplt': ['Pplt', 'Propellant'],
  'propellent': ['Pplt', 'Propellant'],
  'radar': ['Radar', 'Radar'],
  'art': ['Art', 'Artillery'],
  'artillery': ['Art', 'Artillery'],
  'fib': ['Fib', 'Fiber'],
  'fiber': ['Fib', 'Fiber'],
  'rob': ['Rob', 'Robot'],
  'robot': ['Rob', 'Robot'],
  'jet': ['Jet', 'Jet Engine'],
  'jetengine': ['Jet', 'Jet Engine'],
  'ic': ['IC', 'Integrated Circuit'],
  'integratedcircuit': ['IC', 'Integrated Circuit'],
  'santa': ['Santa', 'Santa'],
  'pc': ['PC', 'PC'],
  'car': ['Car', 'Car'],
  'abom': ['Abom', 'Atomic Bomb'],
  'atomicbomb': ['Abom', 'Atomic Bomb'],
  'phone': ['Phone', 'Phone'],
  'sitcom': ['Sitcom', 'Sitcom'],
  'mga': ['Mga', 'Manga'],
  'manga': ['Mga', 'Manga'],
  'hel': ['Hel', 'Helicopter'],
  'helicopter': ['Hel', 'Helicopter'],
  'tank': ['Tank', 'Tank'],
  'movie': ['Movie', 'Movie'],
  'tra': ['Tra', 'Train'],
  'train': ['Tra', 'Train'],
  'zep': ['Zep', 'Zeppelin'],
  'zeppelin': ['Zep', 'Zeppelin'],
  'sucp': ['SuCp', 'Super Computer'],
  'supercomputer': ['SuCp', 'Super Computer'],
  'soft': ['Soft', 'Software'],
  'software': ['Soft', 'Software'],
  'bit': ['Bit', 'Bitcoin'],
  'bitcoin': ['Bit', 'Bitcoin'],
  'air': ['Air', 'Aircraft'],
  'aircraft': ['Air', 'Aircraft'],
  'doge': ['Doge', 'Dogecoin'],
  'dogecoin': ['Doge', 'Dogecoin'],
  'ship': ['Ship', 'Ship'],
  'roc': ['Roc', 'Rocket'],
  'rocket': ['Roc', 'Rocket'],
  'kfu': ['Kfu', 'Kung Fu'],
  'kungfu': ['Kfu', 'Kung Fu'],
  'sat': ['Sat', 'Satellite'],
  'satellite': ['Sat', 'Satellite'],
  'mis': ['Mis', 'Missile'],
  'missile': ['Mis', 'Missile'],
  'anm': ['Anm', 'Anime'],
  'anime': ['Anm', 'Anime'],
  'game': ['Game', 'Game'],
  'rbcar': ['RbCar', 'Robocar'],
  'robocar': ['RbCar', 'Robocar'],
  'btshp': ['Btshp', 'Battleship'],
  'battleship': ['Btshp', 'Battleship'],
  'spa': ['Spa', 'Spaceship'],
  'spaceship': ['Spa', 'Spaceship'],
  'os': ['OS', 'Operating System'],
  'operatingsystem': ['OS', 'Operating System'],
  'www': ['WWW', 'Internet'],
  'internet': ['WWW', 'Internet'],
  'skynt': ['SkyNt', 'Sky Net'],
  'skynet': ['SkyNt', 'Sky Net'],
  'stfgt': ['StFgt', 'Stealth Fighter'],
  'stealthfighter': ['StFgt', 'Stealth Fighter'],
  'sub': ['Sub', 'Submarine'],
  'submarine': ['Sub', 'Submarine'],
  'nmis': ['Nmis', 'Nuclear Missile'],
  'nuclearmissile': ['Nmis', 'Nuclear Missile'],
  'crr': ['Crr', 'Aircraft Carrier'],
  'aircraftcarrier': ['Crr', 'Aircraft Carrier'],
  'con': ['Con', 'Console'],
  'console': ['Con', 'Console'],
  'tai': ['Tai', 'Tai Chi'],
  'taichi': ['Tai', 'Tai Chi'],
  'db': ['DB', 'Database'],
  'database': ['DB', 'Database'],
  'icbm': ['ICBM', 'ICBM'],
  'sns': ['SNS', 'Social Network'],
  'socialnetwork': ['SNS', 'Social Network'],
  'se': ['SE', 'Search Engine'],
  'searchengine': ['SE', 'Search Engine'],
  'iss': ['ISS', 'Space Station'],
  'spacestation': ['ISS', 'Space Station'],
  'airfc': ['AirFc', 'Air Force'],
  'airforce': ['AirFc', 'Air Force'],
  'cldsm': ['CldSm', 'Cloud Streaming'],
  'cloudstreaming': ['CldSm', 'Cloud Streaming'],
  'spfc': ['SpFc', 'Space Force'],
  'spaceforce': ['SpFc', 'Space Force'],
  'navy': ['Navy', 'Navy'],
  'army': ['Army', 'Army'],
  'spco': ['SpCo', 'Space Colony'],
  'spacecolony': ['SpCo', 'Space Colony']
}
</script>
	
</body>
</html>                            